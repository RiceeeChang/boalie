<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>社區公佈欄</title>
    <link rel="shortcut icon" href="./assets/favicon.ico"/>
    <link rel="bookmark" href="./assets/favicon.ico"/>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Noto+Sans+TC">
    <link rel="stylesheet" href="./css/boalie.css"/>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</head>
<body class="billboard">

<div id="app" class="container">
    <div class="nav">
        <a class="nav-item nav-active">公佈欄</a>
    </div>
    <div class="content">
        <div class="title bgcolor_main"><img src="./assets/announcement.png">最近社區公告</div>
        <div class="accordion accordion-flush" id="accordionFlushExample">
            <div class="accordion-item" v-for="announcement in announcements">
                <h2 class="accordion-header post-title" id="flush-headingOne">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" v-bind:data-bs-target="announcement.target" aria-expanded="false" aria-controls="flush-collapseOne">
                    <div class="post-list">
                        <span class="text"><i class="bi bi-circle-fill"></i>{{ announcement.title}}</span>
                        <span class="time">{{ announcement.date }}</span>
                        <span class="author">發布：{{ announcement.author }}</span>
                    </div>
                </button>
                </h2>
                <div v-bind:id="announcement.id" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                <div class="accordion-body">
                    <p v-html="announcement.content"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
const vm = new Vue({
    el: '#app',
    data: {
        announcements: []
    }
});
vm.$mount("#app");
fetch('https://script.google.com/macros/s/AKfycbxPc03U1MIuUpobhhgSAEzgvz5xDQ33aIFCNz7Cw1C9_NlYtFEnE77Y97IsurZfWVja/exec')
.then(function(response) {
    return response.json();
})
.then(function(response) {
    var data = [];
    response.forEach(function(row, index) {
        var anno = {
            'id': 'annoucement-collapse-'+row[0],
            'target': '#annoucement-collapse-'+row[0],
            'date': dateFormat(row[1]),
            'author': row[2],
            'title': row[3],
            'content': replaceContent(row[4])
        }
        data.push(anno);
    })
    vm.announcements = data;
    console.log(response);
});

function dateFormat(datetimeString) {
    var d = new Date(datetimeString);
    var week = {
        "0": "日", "1": "一", "2":"二", "3":"三", "4":"四", "5":"五", "6":"六",
    }
    return d.getFullYear()+"年"+(d.getMonth()+1)%12+"月"+d.getDate()+"日 星期"+week[d.getDay()];
}
function replaceContent(content) {
    content = content.replaceAll('\n', '<br>');

    return content;
}
</script>
</body>
</html>